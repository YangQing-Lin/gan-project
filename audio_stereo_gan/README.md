## ğŸ“„ é¡¹ç›®éœ€æ±‚æ–‡æ¡£
**é¡¹ç›®åç§°**ï¼šä¸­å£°é“â†’ä¾§å£°é“ AI é¢„æµ‹ & GAN ç«‹ä½“å£°é‡æ„
**ç›®æ ‡**ï¼š
- åˆ©ç”¨ GANï¼ˆç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼‰ä»å•å£°é“éŸ³é¢‘é¢„æµ‹ä¾§å£°é“ä¿¡å·
- æ ¹æ®å…¬å¼æ„å»ºç«‹ä½“å£°è¾“å‡ºï¼š
  ```
  L = M + S
  R = M - S
  ```
- å¯åœ¨ macOS + conda ç¯å¢ƒä¸‹è¿è¡Œï¼Œæ”¯æŒä¸­å›½å¤§é™† pip é•œåƒåŠ é€Ÿ

**åŠŸèƒ½éœ€æ±‚**ï¼š
1. **æ•°æ®å‡†å¤‡**
   - è¾“å…¥ï¼šç«‹ä½“å£°éŸ³é¢‘æ•°æ®é›†ï¼ˆWAV/FLACç­‰ï¼‰
   - å¤„ç†ï¼šæå–ä¸­å£°é“ M å’Œä¾§å£°é“ S ç”¨äºè®­ç»ƒ
2. **æ¨¡å‹**
   - åŸºäº PyTorch å®ç°çš„ GAN æ¶æ„
   - ç”Ÿæˆå™¨ï¼šæ¥å— M ç‰¹å¾ç”Ÿæˆ S
   - åˆ¤åˆ«å™¨ï¼šåŒºåˆ†çœŸå® S ä¸ç”Ÿæˆçš„ S
3. **è®­ç»ƒ**
   - ä½¿ç”¨ä¼˜åŒ–å™¨ Adam
   - æŸå¤±å‡½æ•°ï¼šBCE Lossï¼ˆäº¤å‰ç†µï¼‰
   - æ”¯æŒ Apple Silicon GPU (MPS) åŠ é€Ÿ
4. **æ¨ç†**
   - ç»™å•å£°é“éŸ³é¢‘ M â†’ è¾“å‡ºé¢„æµ‹ä¾§å£°é“ S â†’ åˆæˆç«‹ä½“å£° L/R
5. **å¯è§†åŒ–ä¸éªŒè¯**
   - è®­ç»ƒè¿‡ç¨‹ä¸­ä¿å­˜ Loss æ›²çº¿
   - æµ‹è¯•æ ·ä¾‹åˆæˆç«‹ä½“å£°å¹¶æ’­æ”¾/ä¿å­˜æ–‡ä»¶

**éåŠŸèƒ½éœ€æ±‚**ï¼š
- å…¼å®¹ macOS 10.15+ï¼Œæ”¯æŒ M1/M2/M3 èŠ¯ç‰‡
- ä¼˜å…ˆä½¿ç”¨ conda ç®¡ç†ç¯å¢ƒ
- pip ä½¿ç”¨ä¸­å›½å¤§é™†é•œåƒæºä»¥åŠ é€Ÿä¸‹è½½

---

## ğŸ“„ æ“ä½œæ–‡æ¡£

### 1ï¸âƒ£ ç³»ç»Ÿ & è½¯ä»¶å‡†å¤‡
#### 1.1 å®‰è£… Condaï¼ˆæ¨è Minicondaï¼‰
ä¸‹è½½ Minicondaï¼ˆè½»é‡ç‰ˆ Condaï¼‰ï¼š
```bash
# åœ¨ macOS ç»ˆç«¯æ‰§è¡Œï¼š
curl -O https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-arm64.sh
bash Miniconda3-latest-MacOSX-arm64.sh
```
å®‰è£…å®Œæˆåï¼Œæ‰§è¡Œï¼š
```bash
source ~/.zshrc     # æˆ– source ~/.bashrc
conda --version     # éªŒè¯å®‰è£…æˆåŠŸ
```

---

### 2ï¸âƒ£ åˆ›å»ºé¡¹ç›®ç¯å¢ƒï¼ˆä½¿ç”¨ condaï¼‰
```bash
# åˆ›å»ºåä¸º ai_audio_gan çš„ç¯å¢ƒï¼ŒPythonç‰ˆæœ¬å»ºè®® >= 3.9
conda create -n ai_audio_gan python=3.10
conda activate ai_audio_gan
```

---

### 3ï¸âƒ£ é…ç½®ä¸­å›½å¤§é™† pip é•œåƒ
```bash
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
pip config set global.trusted-host pypi.tuna.tsinghua.edu.cn
```
è¿™æ · pip ä¸‹è½½å°±ä¼šèµ° **æ¸…åé•œåƒ**ï¼Œé€Ÿåº¦æ›´å¿«ã€‚

---

### 4ï¸âƒ£ å®‰è£…ä¾èµ–
```bash
# ç§‘å­¦è®¡ç®— & å·¥å…·åº“
pip install numpy matplotlib tqdm

# PyTorchï¼ˆCPUç‰ˆï¼‰
pip install torch torchvision torchaudio

# å¦‚ä¸º Apple Silicon èŠ¯ç‰‡ï¼Œå®‰è£… PyTorch MetalåŠ é€Ÿç‰ˆæœ¬
pip install torch torchvision torchaudio --extra-index-url https://download.pytorch.org/whl/metal.html
```

---

### 5ï¸âƒ£ é¡¹ç›®ç›®å½•ç»“æ„
```plaintext
ai_audio_gan/
â”œâ”€â”€ data/                # æ•°æ®é›†ï¼ˆç«‹ä½“å£°æ–‡ä»¶ï¼‰
â”œâ”€â”€ preprocess.py        # éŸ³é¢‘å¤„ç†ï¼šæå– M/S
â”œâ”€â”€ model.py              # GAN æ¨¡å‹å®šä¹‰
â”œâ”€â”€ train.py              # è®­ç»ƒè„šæœ¬
â”œâ”€â”€ inference.py          # æ¨ç†è„šæœ¬
â”œâ”€â”€ utils.py              # å·¥å…·å‡½æ•°ï¼ˆä¿å­˜éŸ³é¢‘/ç»˜å›¾ï¼‰
â””â”€â”€ requirements.txt      # ä¾èµ–è®°å½•
```

---

### 6ï¸âƒ£ è®­ç»ƒæ¨¡å‹

#### å‡†å¤‡æ•°æ®
å°†ç«‹ä½“å£°éŸ³é¢‘æ–‡ä»¶ï¼ˆWAV/FLAC/MP3ï¼‰æ”¾å…¥ `data/` ç›®å½•ã€‚

**ä»è§†é¢‘ä¸­æå–éŸ³é¢‘ï¼š**
```bash
# æå–ä¸º WAVï¼ˆæ— å‹ç¼©ï¼‰
ffmpeg -i video.mp4 -vn -acodec pcm_s16le output.wav

# æå–ä¸º FLACï¼ˆæ— æŸå‹ç¼©ï¼Œä½“ç§¯æ›´å°ï¼‰
ffmpeg -i video.mp4 -vn -acodec flac output.flac

# æ‰¹é‡æå–å½“å‰ç›®å½•æ‰€æœ‰ mp4 ä¸º flac
for f in *.mp4; do ffmpeg -i "$f" -vn -acodec flac "${f%.mp4}.flac"; done

# æˆªå–éŸ³é¢‘å‰ 10 åˆ†é’Ÿï¼ˆåŠ å¿«è®­ç»ƒï¼‰
ffmpeg -i input.flac -t 600 -acodec flac output.flac
```

**æ£€æŸ¥éŸ³é¢‘æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼š**
```bash
ffprobe -v error -show_entries stream=channels,sample_rate,duration -of compact your_audio.wav
```
è¾“å‡º `channels=2` è¡¨ç¤ºç«‹ä½“å£°ï¼Œç¬¦åˆè®­ç»ƒè¦æ±‚ã€‚

#### è¿è¡Œè®­ç»ƒ
```bash
conda activate ai_audio_gan
cd audio_stereo_gan
python train.py
```

#### è®­ç»ƒè¾“å‡º
| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `gen.pth` | ç”Ÿæˆå™¨æ¨¡å‹æƒé‡ |
| `disc.pth` | åˆ¤åˆ«å™¨æ¨¡å‹æƒé‡ |
| `loss_curve.png` | G/D æŸå¤±æ›²çº¿å›¾ |

#### è®­ç»ƒæŒ‡æ ‡å‚è€ƒ
| å‚æ•° | ç†æƒ³å€¼ | å«ä¹‰ |
|------|--------|------|
| D_loss | â‰ˆ 0.5 | åˆ¤åˆ«å™¨ 50% æ­£ç¡®ç‡ï¼Œåˆ†ä¸æ¸…çœŸå‡ |
| G_loss | â‰ˆ 0.7~1.0 | ç”Ÿæˆå™¨èƒ½ç¨³å®šéª—è¿‡åˆ¤åˆ«å™¨ |

**å¤±è´¥æ¨¡å¼**
| D_loss | G_loss | é—®é¢˜ |
|--------|--------|------|
| â†’0 | â†’âˆ | åˆ¤åˆ«å™¨è¿‡å¼º |
| â†’âˆ | â†’0 | ç”Ÿæˆå™¨è¿‡å¼ºï¼Œè¾“å‡ºå•ä¸€æ¨¡å¼ |

**æˆåŠŸæ ‡å¿—**ï¼šä¸¤è€…åœ¨ 0.5~1.0 åŒºé—´ç¨³å®šæ³¢åŠ¨ï¼Œä¸å†å•å‘ä¸‹é™æˆ–é£™å‡ã€‚

#### å¦‚ä½•çœ‹æŸå¤±æ›²çº¿å›¾
è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šå®æ—¶æ›´æ–° `loss_curve.png`ï¼Œé€šè¿‡æ›²çº¿å½¢æ€åˆ¤æ–­è®­ç»ƒçŠ¶æ€ï¼š

| æ›²çº¿å½¢æ€ | å«ä¹‰ | çŠ¶æ€ |
|----------|------|------|
| ä¸¤çº¿äº¤æ±‡äº 0.5~1.0 | è¾¾åˆ°çº³ä»€å‡è¡¡ | âœ… æˆåŠŸ |
| Dâ†“ Gâ†‘ æŒç»­åˆ†ç¦» | åˆ¤åˆ«å™¨è¿‡å¼º | âŒ éœ€è°ƒå‚ |
| Dâ†‘ Gâ†“ | æ¨¡å¼å´©æºƒ | âŒ éœ€è°ƒå‚ |
| ä¸¤çº¿å‰§çƒˆéœ‡è¡ | è®­ç»ƒä¸ç¨³å®š | âš ï¸ é™ä½å­¦ä¹ ç‡ |

#### ä¿å­˜è®­ç»ƒæˆæœ
```bash
# ä½¿ç”¨å¤‡ä»½è„šæœ¬ï¼ˆæ¨èï¼‰
./backup.sh v1        # å¤‡ä»½åˆ° models/v1_20241203_153025/

# æˆ–æ‰‹åŠ¨å¤‡ä»½
mkdir -p models
cp gen.pth models/gen_$(date +%Y%m%d_%H%M%S).pth
```

ä½¿ç”¨å¤‡ä»½æ¨¡å‹æ¨ç†ï¼š
```bash
python inference.py -i input.wav -m models/v1_20241203_153025/gen.pth
```

---

### 7ï¸âƒ£ æ¨ç†ç”Ÿæˆç«‹ä½“å£°

#### åŸºæœ¬ç”¨æ³•
```bash
python inference.py -i <è¾“å…¥å•å£°é“éŸ³é¢‘> -o <è¾“å‡ºç«‹ä½“å£°éŸ³é¢‘>
```

#### å‚æ•°è¯´æ˜
| å‚æ•° | ç®€å†™ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--input` | `-i` | (å¿…å¡«) | è¾“å…¥å•å£°é“éŸ³é¢‘æ–‡ä»¶ |
| `--output` | `-o` | `output_stereo.wav` | è¾“å‡ºç«‹ä½“å£°æ–‡ä»¶ |
| `--model` | `-m` | `gen.pth` | ç”Ÿæˆå™¨æ¨¡å‹è·¯å¾„ |

#### ç¤ºä¾‹
```bash
# åŸºæœ¬æ¨ç†
python inference.py -i test_mono.wav

# æŒ‡å®šè¾“å‡ºæ–‡ä»¶å’Œæ¨¡å‹
python inference.py -i input.wav -o result.wav -m models/gen.pth
```

#### æ¨ç†è¾“å‡º
- `output_stereo.wav` - ç”Ÿæˆçš„ç«‹ä½“å£°éŸ³é¢‘
- `waveform_m.png` - ä¸­å£°é“æ³¢å½¢å›¾
- `waveform_s.png` - é¢„æµ‹ä¾§å£°é“æ³¢å½¢å›¾

---

### 8ï¸âƒ£ éªŒè¯æ¨¡å‹æ•ˆæœ

ä½¿ç”¨å·²æœ‰çš„åŒå£°é“éŸ³é¢‘éªŒè¯æ¨¡å‹è´¨é‡ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æå– M/S å¹¶ä¸é¢„æµ‹ç»“æœå¯¹æ¯”ã€‚

#### è¿è¡ŒéªŒè¯
```bash
python validate.py -i test_stereo.wav -m gen.pth
```

#### å‚æ•°è¯´æ˜
| å‚æ•° | ç®€å†™ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--input` | `-i` | (å¿…å¡«) | åŸå§‹åŒå£°é“éŸ³é¢‘æ–‡ä»¶ |
| `--model` | `-m` | `gen.pth` | ç”Ÿæˆå™¨æ¨¡å‹è·¯å¾„ |

#### è¾“å‡ºæŒ‡æ ‡
| æŒ‡æ ‡ | å«ä¹‰ | ç†æƒ³å€¼ |
|------|------|--------|
| MSE | å‡æ–¹è¯¯å·® | è¶Šå°è¶Šå¥½ |
| ç›¸å…³ç³»æ•° | é¢„æµ‹ä¸çœŸå®çš„ç›¸å…³æ€§ | è¶Šæ¥è¿‘ 1 è¶Šå¥½ |

#### è¯„ä»·æ ‡å‡†
| ç›¸å…³ç³»æ•° | è¯„ä»· |
|----------|------|
| > 0.7 | âœ… ä¼˜ç§€ |
| 0.4 ~ 0.7 | âš ï¸ ä¸€èˆ¬ï¼Œå¯ç»§ç»­è®­ç»ƒ |
| < 0.4 | âŒ è¾ƒå·®ï¼Œéœ€è°ƒæ•´æ¨¡å‹æˆ–æ•°æ® |

#### éªŒè¯è¾“å‡º
- `validation_result.png` - æ³¢å½¢å¯¹æ¯”å›¾ï¼ˆåŸå§‹ S / é¢„æµ‹ S / å·®å¼‚ï¼‰

---

### 9ï¸âƒ£ Mermaid è®­ç»ƒ+æ¨ç†æ€»è§ˆå›¾
```mermaid
flowchart TB
    subgraph Train["è®­ç»ƒé˜¶æ®µ"]
        Stereo[(ç«‹ä½“å£° L/R æ ·æœ¬)]
        Stereo --> Mform["æå– M = (L + R)/2"]
        Stereo --> Sform["æå– S = (L - R)/2"]
        Mform --> GeneratorTrain[ç”Ÿæˆå™¨è¾“å…¥ M]
        Sform --> DiscriminatorTrain[åˆ¤åˆ«å™¨è¾“å…¥çœŸå® S]
        GeneratorTrain -->|ç”Ÿæˆå‡ S| DiscriminatorTrain
    end

    subgraph Inference["æ¨ç†é˜¶æ®µ"]
        Mono[(ä¸­å£°é“ M è¾“å…¥)]
        Mono --> TrainedGen[ç”Ÿæˆå™¨é¢„æµ‹ S]
        TrainedGen --> Lout["L = M + S"]
        TrainedGen --> Rout["R = M - S"]
        Lout --> StereoOut[(è¾“å‡ºç«‹ä½“å£°)]
        Rout --> StereoOut
    end
```

---

âœ… ç°åœ¨ä½ æœ‰ **é¡¹ç›®éœ€æ±‚æ–‡æ¡£** å’Œ **æ“ä½œæ–‡æ¡£**ï¼Œä¸€æ­¥æ­¥æ­å¥½ç¯å¢ƒå¹¶è¿è¡Œ GAN è®­ç»ƒï¼Œä¸”å…¨ç¨‹é€‚é… **conda** + **ä¸­å›½å¤§é™†é•œåƒ**ã€‚
